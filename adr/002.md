#ADR-002: Implementing Optimistic Updates directly in a Page Component

Context.

    To improve the user experience (Usability), operations that change data (edit, delete tracks, delete files, bulk delete) should display the result instantly in the UI, without waiting for a response from the server. This is achieved with the help of optimistic updates. There was a custom hook called useTrackMutations, but it was decided to move the logic of optimistic updates directly to the TracksPage.tsx component.
    Solution.

    Implement the optimistic update logic for UPDATE, DELETE (single and bulk), DELETE FILE, and genre removal operations on a track directly in the TracksPage.tsx component. This includes:

        Saving the current state of the track list.

        Instantly updating the local state of the track list (obtained from useTracks via setTracks) to reflect the expected result.

        Calling the corresponding API function.

        If successful, it optionally confirms the status with data from the server or reloads the list.

        In case of failure, the local state is rolled back to the initial state and the user is informed.

        Loading states for these mutations are also managed in TracksPage.tsx.

Alternatives.

    Fully implement optimistic updates in the useTrackMutations Hook: This would make TracksPage.tsx cleaner, but would make the useTrackMutations Hook itself more complex, as it would need to somehow get and update the state of the tracks (e.g., via callbacks or by returning an updated list).

    Use a server-side state management library with built-in support for optimistic updates (e.g., React Query, SWR): These libraries greatly simplify the implementation of optimistic updates, but add a new dependency and require learning their API. At the time of development, this could have been considered an excessive complication for the current project scope.

    Do not use optimistic updates: This would degrade the UX as users would have to wait for the server to respond to see the results of their actions.

Consequences.

    Positive:

        Improved UX: Users see the results of their actions (editing, deleting) instantly.

        Full control over the process: The developer has full control over how and when the UI is updated.

    Negatives:

        Increased complexity of TracksPage.tsx: This component becomes responsible for a large part of the logic for managing state and side effects, which degrades its readability and maintainability (as mentioned in the ADR about the state manager).

        Duplication of logic: The pattern of “save state -> optimistically update -> call API -> handle success/failure -> rollback on error” can be repeated for several operations.